$(document).on("turbolinks:load", function() {
    //var $ = jQuery.noConflict();
    jQuery(document).ready(function (a) {
        a("body").on("submit", "form#login", function (b) {

            a("p.status", this).show().text(ajax_auth_object.loadingmessage);
            let username = a("form#login #username").val(),
                password = a("form#login #password").val(),
                recaptcha = a("#g-recaptcha-response").val(),
                ctrl = a(this);

                a.ajax({
                    type: "POST",
                    dataType: "json",
                    url: ajax_auth_object.login_url,
                    data: {
                        email: username,
                        password: password,
                        recaptcha: recaptcha
                    },
                    success: function (b) {
                        a("p.status", ctrl).text(b.message);

                        if (b.status === "success") {
                            Turbolinks.visit(ajax_auth_object.redirecturl);
                            return false;
                        }

                        //grecaptcha.reset();
                    }
                });

                b.preventDefault()
        });

        a("body").on("submit", "form#register", function (b) {

            a("p.status", this).show().text(ajax_auth_object.loadingmessage);

            let password = a("#signup_password").val(),
                email = a("#signup_email").val(),
                ctrl = a(this),
                recaptcha = a("#g-recaptcha-response").val();

                a.ajax({
                    type: "POST",
                    dataType: "json",
                    url: ajax_auth_object.register_url,
                    data: {
                        email: email,
                        password: password,
                        recaptcha: recaptcha
                    },
                    success: function (b) {
                        a("p.status", ctrl).text(b.message);
                        if (b.status === "success") {
                            Turbolinks.visit(ajax_auth_object.redirecturl);
                            return false;
                        }

                        //grecaptcha.reset();
                    }
                }), b.preventDefault()
        });

        a("body").on("submit", "form#forgot_password", function (b) {
            return a("p.status", this).show().text(ajax_auth_object.loadingmessage), ctrl = a(this), a.ajax({
                type: "POST",
                dataType: "json",
                url: ajax_auth_object.forgot_password_url,
                data: {
                    action: "ajaxforgotpassword",
                    user_login: a("#user_login").val(),
                    recaptcha: a("#g-recaptcha-response-2").val()
                },
                success: function (b) {
                    a("p.status", ctrl).text(b.message);
                    a("#recaptcha-reset-forgot-password").click()
                }
            }), b.preventDefault(), !1
        });

    });

    $('#userInfo').on('click', function () {
        openLoginModal();
    });

    $('body').on('click', '#showRegisterFrom', function () {
        openRegisterModal();
    });

    $('body').on('click', '#showLoginFrom', function () {
        openLoginModal();
    });

    $('body').on('click', '#showForgotPasswordForm', function () {
        showForgotPasswordForm();
    });

    function showRegisterForm() {
        $(".loginBox").fadeOut("fast", function () {
            $(".registerBox").fadeIn("fast"), $(".forgotPasswordBox").fadeOut("fast"), $(".login-footer").fadeOut("fast", function () {
                $(".register-footer").fadeIn("fast")
            }), $(".modal-title").html(ajax_auth_object.languages.register_with)
        }), $(".error").removeClass("alert alert-danger").html("")
    }

    function showForgotPasswordForm() {
        $(".loginBox").fadeOut("fast", function () {
            $(".forgotPasswordBox").fadeIn("fast"), $(".register-footer").fadeOut("fast", function () {
                $(".login-footer").fadeIn("fast")
            }), $(".modal-title").html(ajax_auth_object.languages.forgotpassword)
        }), $(".error").removeClass("alert alert-danger").html("")
    }

    function showLoginForm() {
        $("#loginModal .registerBox").fadeOut("fast", function () {
            $(".loginBox").fadeIn("fast"), $(".forgotPasswordBox").fadeOut("fast"), $(".register-footer").fadeOut("fast", function () {
                $(".login-footer").fadeIn("fast")
            }), $(".modal-title").html(ajax_auth_object.languages.login_with)
        }), $(".error").removeClass("alert alert-danger").html("")
    }

    function openLoginModal() {
        showLoginForm();
        /*var a = document.createElement("script");
        a.src = "//www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit";
        $("head").append(a);*/

        var b = '<div class="modal fade login" id="loginModal">\n' +
            '    <div class="modal-dialog login animated">\n' +
            '        <div class="modal-content">\n' +
            '            <div class="modal-header">\n' +
            '                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">\xD7</button>\n' +
            '                <h4 class="modal-title">' + ajax_auth_object.languages.login + '</h4></div>\n' +
            '            <div class="modal-body">\n' +
            '                <div class="content">\n' +
            '                    <!--<div class="social" id="ajax-social-login">\n' +
            '                        <a id="facebook_login" class="circle facebook" href="javascript:showNotice();">\n' +
            '                            <i class="hl-facebook"></i> </a>\n' +
            '                        <a id="google_login" class="circle google" href="javascript:showNotice();">\n' +
            '                            <i class="hl-gplus"></i> </a>\n' +
            '                        <a id="twitter_login" class="circle twitter" href="javascript:showNotice();">\n' +
            '                            <i class="hl-twitter"></i> </a></div>\n' +
            '                    <div class="division">\n' +
            '                        <div class="line l"></div>\n' +
            '                        <span>' + ajax_auth_object.languages.or + '</span>\n' +
            '                        <div class="line r"></div>\n' +
            '                    </div> -->\n' +
            '                    <div class="error"></div>\n' +
            '                    <div class="form loginBox">\n' +
            '                        <form id="login" method="post" accept-charset="UTF-8"><p class="status"></p>\n' +
            '                            <input id="username" class="form-control" type="text" placeholder="' + ajax_auth_object.languages.email + '" name="username">\n' +
            '                            <input id="password" class="form-control" type="password" placeholder="' + ajax_auth_object.languages.password + '" name="password">\n' +
            '                            <button class="btn btn-default btn-login" type="submit">' + ajax_auth_object.languages.login + '</button>\n' +
            '                        </form>\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '                <div class="content registerBox" style="display:none;">\n' +
            '                    <div class="form">\n' +
            '                        <form id="register" method="post" html="{:multipart=>true}" data-remote="true" action="" accept-charset="UTF-8">\n' +
            '                            <p class="status"></p>\n' +
            '                            <input id="signup_name" class="form-control" type="text" placeholder="' + ajax_auth_object.languages.username + '" name="username" class="required">\n' +
            '                            <input id="signup_email" class="form-control" type="text" placeholder="' + ajax_auth_object.languages.email + '" name="email">\n' +
            '                            <input id="signup_password" class="form-control" type="password" placeholder="' + ajax_auth_object.languages.password + '" name="password">\n' +
            '<button class="btn btn-default btn-register" type="submit">' + ajax_auth_object.languages.create_account + '</button>\n' +
            '                        </form>\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '                <div class="content forgotPasswordBox" style="display:none;">\n' +
            '                    <div class="form">\n' +
            '                        <form id="forgot_password" method="post" action="" accept-charset="UTF-8"><p class="status"></p>\n' +
            '                            <input id="user_login" class="form-control" type="text" placeholder="' + ajax_auth_object.languages.username_email + '" class="required" name="user_login">\n' +
            '                            <button class="btn btn-default btn-forgot" type="submit">' + ajax_auth_object.languages.reset_password + '</button>\n' +
            '                        </form>\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <div class="modal-footer">\n' +
            '                <div class="forgot login-footer">\n' +
            '                    <span><a id="showRegisterFrom" href="javascript:void(0);">' + ajax_auth_object.languages.register + ' </a></span>|\n' +
            '                    <span><a id="showForgotPasswordForm" href="javascript:void(0);">' + ajax_auth_object.languages.forgotpassword + '</a>                </span>\n' +
            '                </div>\n' +
            '                <div class="forgot register-footer" style="display:none">\n' +
            '                    <span>' + ajax_auth_object.languages.already_account + '</span>\n' +
            '                    <a href="javascript:void(0);" id="showLoginFrom">' + ajax_auth_object.languages.login + '</a></div>\n' +
            '            </div>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '</div>';

        $("body").append(b);

        setTimeout(function () {
            $("#loginModal").modal("show");
            $("#loginModal").on("hidden.bs.modal", function () {
                $(this).remove()
            });
        }, 200)
    }

    function openRegisterModal() {
        showRegisterForm(), setTimeout(function () {
            $("#loginModal").modal("show")
        }, 200)
    }

    function showNotice() {
        alert("Comming soon...")
    }
});